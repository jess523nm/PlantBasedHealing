<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Plant-Based Reflection Tool ‚Äî Skeleton</title>
  <style>
    :root{
      --card-bg: rgba(10, 12, 18, 0.72);
      --card-border: rgba(255,255,255,0.14);
      --text: rgba(255,255,255,0.92);
      --muted: rgba(255,255,255,0.72);
      --btn: rgba(255,255,255,0.10);
      --btn-hover: rgba(255,255,255,0.16);
      --focus: rgba(255,255,255,0.25);
      --green: rgba(72, 187, 120, 0.95);
      --yellow: rgba(236, 201, 75, 0.95);
      --red: rgba(245, 101, 101, 0.95);
    }

    body{
      margin:0;
      min-height:100vh;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      color: var(--text);

      /* ‚Äúdark early sunrise‚Äù stripe vibe */
      background:
        linear-gradient(180deg,
          #050611 0%,
          #0a0b1c 18%,
          #141233 36%,
          #241842 52%,
          #3a1d4b 66%,
          #4b2555 78%,
          #5b2f5f 88%,
          #6a3c68 100%);
      background-attachment: fixed;
    }

    .wrap{
      max-width: 980px;
      margin: 0 auto;
      padding: 28px 16px 80px;
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom: 16px;
    }

    .brand{
      font-weight: 650;
      letter-spacing: 0.2px;
      opacity: 0.95;
    }

    .pill{
      font-size: 12px;
      padding: 6px 10px;
      border: 1px solid var(--card-border);
      border-radius: 999px;
      background: rgba(255,255,255,0.06);
      color: var(--muted);
      user-select:none;
    }

    .card{
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 18px;
      padding: 18px 18px 16px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.35);
      backdrop-filter: blur(8px);
    }

    h1,h2{
      margin: 0 0 10px;
      line-height: 1.2;
    }
    h1{ font-size: 22px; }
    h2{ font-size: 18px; opacity: 0.95; }

    p{
      margin: 8px 0 0;
      color: var(--muted);
      line-height: 1.45;
    }

    .btnrow{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      margin-top: 14px;
    }

    button{
      border: 1px solid var(--card-border);
      background: var(--btn);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 12px;
      cursor:pointer;
      font-weight: 600;
      transition: 0.12s ease;
    }
    button:hover{ background: var(--btn-hover); }
    button:focus{ outline: 2px solid var(--focus); outline-offset: 2px; }

    .btn-green{ background: rgba(72,187,120,0.20); border-color: rgba(72,187,120,0.40); }
    .btn-yellow{ background: rgba(236,201,75,0.20); border-color: rgba(236,201,75,0.40); }
    .btn-red{ background: rgba(245,101,101,0.20); border-color: rgba(245,101,101,0.40); }

    .navrow{
      display:flex;
      gap:10px;
      justify-content:space-between;
      margin-top: 14px;
      padding-top: 12px;
      border-top: 1px solid rgba(255,255,255,0.08);
    }

    .left, .right{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }

    .small{
      font-size: 12px;
      color: var(--muted);
    }

    .checklist{
      margin-top: 12px;
      display:grid;
      gap:10px;
    }

    label.chk{
      display:flex;
      gap:10px;
      align-items:flex-start;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.05);
      cursor:pointer;
    }

    input[type="checkbox"], input[type="radio"]{
      margin-top: 2px;
      transform: scale(1.12);
      accent-color: rgba(255,255,255,0.85);
    }

    .modalback{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.55);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 18px;
      z-index: 50;
    }

    .modal{
      max-width: 820px;
      width: 100%;
      background: rgba(12, 14, 22, 0.92);
      border: 1px solid rgba(255,255,255,0.16);
      border-radius: 18px;
      padding: 16px;
      box-shadow: 0 14px 70px rgba(0,0,0,0.55);
    }

    .modal .scroll{
      max-height: 48vh;
      overflow:auto;
      border: 1px solid rgba(255,255,255,0.10);
      border-radius: 14px;
      padding: 12px;
      background: rgba(255,255,255,0.04);
    }

    .divider{
      height: 1px;
      background: rgba(255,255,255,0.08);
      margin: 12px 0;
    }

    .imgbox{
      margin-top: 12px;
      border-radius: 16px;
      border: 1px dashed rgba(255,255,255,0.28);
      background: rgba(255,255,255,0.04);
      padding: 14px;
      color: rgba(255,255,255,0.72);
    }

    /* Dropdown styling for 1BX evidence boxes */
    details.drop {
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 12px;
      padding: .75rem .9rem;
      margin: .6rem 0;
      background: rgba(255,255,255,.03);
    }
    details.drop summary {
      cursor: pointer;
    }
    details.drop p,
    details.drop ul {
      margin-top: .6rem;
    }

  </style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">Plant-Based Reflection Tool v. 1</div>
      <div class="pill" id="progressPill">Step: ‚Äî</div>
    </div>

    <div class="card" id="app"></div>
  </div>

  <!-- Disclaimer Modal -->
  <div class="modalback" id="disclaimerModal">
    <div class="modal">
      <h2>Welcome - Before you Begin</h2>
        <div class="scroll">
          <p><b>This interactive flowchart is not about laws, politics, or what should be legal or illegal.</b></p>

          <p>It is only about your own personal moral decision-making ‚Äî what you feel is right or wrong for you to do in your own life.</p>

          <div class="divider"></div>

          <p><b>Standard disclaimer:</b> This tool is not a medical, psychological, legal, or nutritional assessment. It does not provide medical or mental health advice.</p>

          <p>If you have health concerns or questions about your wellbeing, please consult a qualified professional.</p>
        </div>

      <div class="divider"></div>

      <label class="chk" style="margin:0;">
        <input id="agreeBox" type="checkbox" />
        <span><b>I have read this information and agree.</b></span>
      </label>

      <div class="btnrow">
        <button id="startBtn">Continue</button>
      </div>
      <p class="small">To continue, check the box above.</p>
    </div>
  </div>

  <!-- Yellow Feedback Modal -->
  <div class="modalback" id="yellowExitModal" style="display:none;">
    <div class="modal">
      <h2>üü° Feedback</h2>
      <div class="scroll">
        
        <p><b>‚ÄúI think this question is logically flawed, incomplete, or unfair.‚Äù</b></p>

        <p>Thank you ‚Äî this is genuinely helpful feedback for future development.</p>

        <p>This flowchart is a work in progress, and it‚Äôs designed to be improved over time. If you believe a question contains a logical fallacy, a false assumption, a misleading framing, or an unfair simplification, please let me know so I can reassess it.</p>

        <p><b>You can email your feedback here:</b><br/>
        <a href="mailto:Jessica.henry523@gmail.com">Jessica.henry523@gmail.com</a></p>
        
        <img src="yellow.png" alt="Feedback" style="max-width:100%; border-radius:12px; margin-bottom:1rem;" />

      </div>

      <div class="divider"></div>

      <div class="btnrow">
        <button onclick="yellowExitToEmail()">Exit to email</button>
        <button onclick="closeYellowExit()">Go back ‚Äî I clicked yellow by mistake</button>
      </div>
    </div>
  </div>

  <!-- Red Exit Modal -->
  <div class="modalback" id="redExitModal" style="display:none;">
    <div class="modal">
      <h2 id="redExitTitle">üî¥ Exit</h2>
      <div class="scroll" id="redExitBody">
        <!-- Filled by JS -->
      </div>

      <div class="divider"></div>

      <div class="btnrow">
        <button onclick="redExitNow()">Exit</button>
        <button onclick="closeRedExit()">Go back ‚Äî I clicked red by mistake</button>
      </div>
    </div>
  </div>

  <script>

    // ----- Yellow Exit (feedback) modal helpers -----
    function openYellowExit(){
      const m = document.getElementById("yellowExitModal");
      if(m) m.style.display = "flex";
    }
    function closeYellowExit(){
      const m = document.getElementById("yellowExitModal");
      if(m) m.style.display = "none";
    }

    function yellowExitToEmail(){
      // 1) open email in a new tab/window (more reliable than location.href)
      window.open("mailto:Jessica.henry523@gmail.com", "_blank");

      // 2) close modal
      closeYellowExit();

      // 3) return to start and re-show disclaimer
      go(STEPS.START);
      setTimeout(() => {
        openDisclaimerThen(null, { autoOpen:true });
      }, 0);
    }


    // ----- Red Exit modal helpers -----
    function openRedExit(kind){
      const m = document.getElementById("redExitModal");
      const title = document.getElementById("redExitTitle");
      const body = document.getElementById("redExitBody");

      if(!m || !title || !body) return;

      let t = "üî¥ Exit";
      let html = "";

      if(kind === "psych"){
        t = "üî¥ Exit ‚Äî Psychological";
        html = `
          <p>Thank you for answering honestly.</p>
          <p>We strongly recommend that you consider speaking with a licensed mental health professional before returning to this reflection.</p>
          <img src="psychology.png" alt="Psychological support" style="max-width:100%; border-radius:12px; margin-bottom:1rem;" />
          `;
      } 
      else if(kind === "medical"){
        t = "üî¥ Exit ‚Äî Medical";
        html = `
          <img src="doctor.png" alt="Medical support" style="max-width:100%; border-radius:12px; margin-bottom:1rem;" />
          <p>Based on your responses so far, we think it would be a good idea to speak with a qualified physician or nutrition professional before continuing or returning to this reflection.</p>
        `;
      } 
      else if(kind === "religious"){
        t = "üî¥ Exit ‚Äî Religious";
        html = `
          <img src="religion.png" alt="Religious or spiritual guidance" style="max-width:100%; border-radius:12px; margin-bottom:1rem;" />
          <p>Based on your responses so far, we think it would be a good idea to speak with a qualified spiritual or religious leader before continuing or returning to this reflection.</p>
        `;
      } 
      else if(kind === "cultural"){
        t = "üî¥ Exit ‚Äî Cultural";
        html = `
          <img src="culture.png" alt="Cultural guidance" style="max-width:100%; border-radius:12px; margin-bottom:1rem;" />
          <p>Thank you for reflecting on this.</p>
          <p>We recommend speaking with a respected elder, teacher, or knowledge-holder from your cultural or ancestral tradition to explore how these practices are understood today.</p>
          <p>Many traditions emphasize respect, restraint, and minimizing harm ‚Äî and there may be guidance available that aligns both with your values and your heritage.</p>
          <p>If you choose to continue consuming animal products for cultural reasons, consider ways to reduce harm where possible (such as avoiding industrial sources or supporting practices rooted in respect and sustainability).</p>
        `;
      } 
      else {
        html = `<p>Thank you for answering honestly.</p>`;
      }

      title.textContent = t;
      body.innerHTML = html;
      m.style.display = "flex";
    }


    function closeRedExit(){
      const m = document.getElementById("redExitModal");
      if(m) m.style.display = "none";
    }

    function redExitNow(){
      // Close the red exit modal
      closeRedExit();

      // Go back to the start screen
      go(STEPS.START);

      // Re-open the disclaimer modal after render
      setTimeout(() => {
        openDisclaimerThen(null, { autoOpen:true });
      }, 0);
    }


    /***********************
     * STATE + ROUTING
     ***********************/
    const state = {
      stepId: "START",
      history: [],

      dietStatus: null, // "already" | "thinking" | "not"
      part1: {
        // store answers if you want later:
        a: null,
        b: null,
        c: null,
        cxSelected: [] // which of 1CX1-5 they want to explore
      },

      part2: {
        blockersSelected: [],     // checklist in Part 2
        blockersQueue: [],        // queue we walk through
      },

      // used to alter stakes copy:
      showSavedSpin: false
    };

    const STEPS = {
      START: "START",
      DIET_STATUS: "DIET_STATUS",

      // Part 1 core
      P1_1A: "P1_1A",
      P1_1B: "P1_1B",
      P1_1BX: "P1_1BX",     // optional ‚Äúobjections‚Äù drawer page
      P1_1C: "P1_1C",
      P1_1CX_PICK: "P1_1CX_PICK",
      P1_1CX1: "P1_1CX1",

      P1_1CX2: "P1_1CX2",
      P1_1CX2_TRANSITION: "P1_1CX2_TRANSITION",
      P1_1CX2_BUDDHIST: "P1_1CX2_BUDDHIST",
      P1_1CX2_CHRISTIAN: "P1_1CX2_CHRISTIAN",
      P1_1CX2_HINDU: "P1_1CX2_HINDU",
      P1_1CX2_JEWISH: "P1_1CX2_JEWISH",
      P1_1CX2_MUSLIM: "P1_1CX2_MUSLIM",
      P1_1CX2_SIKH: "P1_1CX2_SIKH",

      P1_1CX3: "P1_1CX3",
      P1_1CX4: "P1_1CX4",
      P1_1CX5: "P1_1CX5",

      // Part 2
      P2_INTRO: "P2_INTRO",
      P2_2A: "P2_2A",               // general ‚Äúplant-based can be nutritionally sound‚Äù
      P2_BLOCKERS_PICK: "P2_BLOCKERS_PICK",
      P2_BLOCKER_DETAIL: "P2_BLOCKER_DETAIL",

      // End
      STAKES: "STAKES"
    };

    // 1CX options (fixed order)
    const CX_ORDER = [
      { id:"1CX1", label:"1. Purpose-based exemption ‚Äî ‚ÄúAnimals raised for food are different from pets.‚Äù", step: STEPS.P1_1CX1 },
      { id:"1CX2", label:"2. Religious exemption ‚Äî ‚ÄúGod permits or commands us to eat animals.‚Äù", step: STEPS.P1_1CX2 },
      { id:"1CX3", label:"3. Appeal to nature ‚Äî ‚ÄúPredation is natural, so it‚Äôs morally fine.‚Äù", step: STEPS.P1_1CX3 },
      { id:"1CX4", label:"4. Cultural / identity exemption ‚Äî ‚ÄúThis is part of my culture / ancestry / identity.‚Äù", step: STEPS.P1_1CX4 },
      { id:"1CX5", label:"5. Human-centered priority ‚Äî ‚ÄúHuman comfort outweighs animal suffering.‚Äù", step: STEPS.P1_1CX5 },
    ];

    // Part 2 blocker topics (you can rename later)
    const BLOCKERS = [
      { id: "env", label: "Environmental impact concerns" },
      { id: "health", label: "Nutrition & health concerns (including allergies, GI, pregnancy/lactation, ED, sensory, mental health)" },
      { id: "cost", label: "Cost & availability concerns" },
      { id: "habit", label: "Habit / taste / change concerns" },
      { id: "science", label: "I don‚Äôt trust science / research (conspiracy, etc.)" }
    ];

    /***********************
     * UTIL
     ***********************/
    const $app = document.getElementById("app");
    const $pill = document.getElementById("progressPill");

    function pushHistory(prevStep){
      state.history.push(prevStep);
    }

    function go(stepId){
      if (state.stepId && state.stepId !== stepId) pushHistory(state.stepId);
      state.stepId = stepId;
      render();
    }

    function back(){
      const prev = state.history.pop();
      if (!prev) return;
      state.stepId = prev;
      render();
    }

    function setPill(text){
      $pill.textContent = text;
    }

    function navButtons({ showBack=true, nextLabel="Next", onNext=null, showNext=true }){
      return `
        <div class="navrow">
          <div class="left">
            ${showBack ? `<button onclick="window.__back()">Back</button>` : `<span></span>`}
          </div>
          <div class="right">
            ${showNext ? `<button onclick="window.__next()">${nextLabel}</button>` : ``}
          </div>
        </div>
      `;
    }

    // Expose handlers for inline onclick
    window.__back = back;

    // __next is set per-render for pages that use Next
    window.__next = () => {};

    function threeButtons({ onGreen, onYellow, onRed }){
      return `
        <div class="btnrow">
          <button class="btn-green" onclick="(${onGreen})()">üü¢ Green</button>
          <button class="btn-red" onclick="(${onRed})()">üî¥ Red</button>
          <button class="btn-yellow" onclick="(${onYellow})()">üü° Yellow</button>
        </div>
        <p class="small">Wording for these buttons is placeholder; you‚Äôll swap in your exact labels later.</p>
      `;
    }


    /***********************
     * RENDER PAGES
     ***********************/
    function render(){
      switch(state.stepId){
        case STEPS.START: return renderStart();
        case STEPS.DIET_STATUS: return renderDietStatus();

        case STEPS.P1_1A: return renderP1_1A();
        case STEPS.P1_1B: return renderP1_1B();
        case STEPS.P1_1BX: return renderP1_1BX();
        case STEPS.P1_1C: return renderP1_1C();
        case STEPS.P1_1CX_PICK: return renderP1_1CX_PICK();
        case STEPS.P1_1CX1: return renderP1_1CX1();
        case STEPS.P1_1CX2: return renderP1_1CX2();

        case STEPS.P1_1CX2_TRANSITION: return renderP1_1CX2Transition();
        case STEPS.P1_1CX2_BUDDHIST: return renderP1_1CX2Buddhist();
        case STEPS.P1_1CX2_CHRISTIAN: return renderP1_1CX2Christian();
        case STEPS.P1_1CX2_HINDU: return renderP1_1CX2Hindu();
        case STEPS.P1_1CX2_JEWISH: return renderP1_1CX2Jewish();
        case STEPS.P1_1CX2_MUSLIM: return renderP1_1CX2Muslim();
        case STEPS.P1_1CX2_SIKH: return renderP1_1CX2Sikh();

        case STEPS.P1_1CX3: return renderP1_1CX3();
        case STEPS.P1_1CX4: return renderP1_1CX4();
        case STEPS.P1_1CX5: return renderP1_1CX5();

        case STEPS.P2_INTRO: return renderP2_Intro();
        case STEPS.P2_2A: return renderP2_2A();
        case STEPS.P2_BLOCKERS_PICK: return renderP2_BlockersPick();
        case STEPS.P2_BLOCKER_DETAIL: return renderP2_BlockerDetail();

        case STEPS.STAKES: return renderStakes();

        default:
          $app.innerHTML = `<h1>Unknown step: ${state.stepId}</h1>` + navButtons({});
      }
    }

    function renderStart(){
      setPill("Step: Start");
      $app.innerHTML = `
            <h1>Welcome</h1>

            <p><b>This tool is about your own personal moral reasoning.</b></p>

            <p>It‚Äôs not about what is legal, socially expected, or politically debated.</p>

            <p>It‚Äôs a structured way to reflect on what <i>you</i> personally feel is right or wrong for you to do ‚Äî and whether your values feel consistent with your choices.</p>

            <img src="welcomescreen.png" alt="Welcome illustration" style="max-width:100%; margin:1.5rem 0; border-radius:12px;" />

            ${navButtons({ showBack:false, nextLabel:"Begin", showNext:true })}
          `;


      window.__next = () => {
        openDisclaimerThen(() => go(STEPS.DIET_STATUS));
      };

      // Auto-open disclaimer on first load if not yet agreed:
      openDisclaimerThen(null, { autoOpen:true });
    }

    function renderDietStatus(){
      setPill("Step: Diet status");
      $app.innerHTML = `
            <h1>Diet status</h1>
            <p>Select one:</p>

            <div class="checklist">
              <label class="chk">
                <input type="radio" name="diet" value="already" ${state.dietStatus==="already" ? "checked":""}/>
                <span><b>I already eat a plant-based diet.</b></span>
              </label>

              <label class="chk">
                <input type="radio" name="diet" value="thinking" ${state.dietStatus==="thinking" ? "checked":""}/>
                <span><b>I‚Äôm thinking about eating a plant-based diet.</b></span>
              </label>

              <label class="chk">
                <input type="radio" name="diet" value="not" ${state.dietStatus==="not" ? "checked":""}/>
                <span><b>I do not eat a plant-based diet.</b></span>
              </label>
            </div>

            <img src="welcomescreen2.png"
                alt="Diet reflection illustration"
                style="display:block; width:100%; max-width:100%; margin:1.5rem auto; border-radius:12px;" />

            ${navButtons({ showBack:true, nextLabel:"Continue" })}
          `;


      window.__next = () => {
        const sel = document.querySelector('input[name="diet"]:checked');
        if(!sel){
          alert("Choose one option to continue.");
          return;
        }
        state.dietStatus = sel.value;

        if(state.dietStatus === "already"){
          // You wanted: ask if they want to explore anyway; if no -> stakes (saved spin)
          state.showSavedSpin = true;
          go(STEPS.STAKES);
        } else {
          state.showSavedSpin = false;
          go(STEPS.P1_1A);
        }
      };
    }

    function renderP1_1A(){
      setPill("Part 1 ‚Äî 1A");

      $app.innerHTML = `
        <h1>Part 1 ‚Äî 1A</h1>

        <p><b>For you personally, is it morally acceptable to abuse, torture, or kill cats or dogs ‚Äî or to pay other people to do that for you ‚Äî solely for your own pleasure?</b></p>

        <p class="small">(This is not about legality, culture, or what others do. This is only about what you personally feel is morally acceptable for you.)</p>

        <img src="1A.jpg" alt="Part 1 ‚Äî 1A" style="max-width:100%; margin:1.25rem 0; border-radius:12px;" />

        <div class="btnrow">
          <button class="btn-green" onclick="__p1aNo()">üü¢ No</button>
          <button class="btn-red" onclick="__p1aYes()">üî¥ Yes</button>
          <button class="btn-yellow" onclick="__p1aYellow()">üü° Unsure / flawed question</button>
        </div>

        <div class="divider"></div>

        <p class="small"><b>üü¢ No:</b> ‚ÄúNo. Even if I‚Äôm not a pet person, I believe that abusing or killing animals for enjoyment is wrong, and I would not do that.‚Äù</p>
        <p class="small"><b>üî¥ Yes:</b> ‚ÄúYes. I am comfortable with harming or killing animals for pleasure.‚Äù</p>
        <p class="small"><b>üü° Unsure / flawed question:</b> ‚ÄúI think this question is logically flawed, incomplete, or unfair.‚Äù</p>

        ${navButtons({ showBack:true, showNext:false })}
      `;

      // Handlers (avoid inline arrow-function strings so buttons work reliably)
      window.__p1aNo = () => {
        state.part1.a = "no";
        go(STEPS.P1_1B);
      };

      window.__p1aYes = () => {
        state.part1.a = "yes";
        openRedExit("psych"); // psychological exit for this step
      };

      window.__p1aYellow = () => {
        state.part1.a = "yellow";
        openYellowExit();
      };

      window.__next = () => {};
    }


    function renderP1_1B(){
      setPill("Part 1 ‚Äî 1B");

      $app.innerHTML = `
        <h1>Part 1 ‚Äî 1B</h1>

        <p><b>The reason I believe it is morally wrong to abuse, torture, or kill cats or dogs for pleasure is because cats and dogs are sentient beings ‚Äî they can feel pain, suffer, form emotional bonds, and have subjective experiences ‚Äî which makes their unnecessary suffering morally wrong.</b></p>

        <p><b>Do you agree with this statement?</b></p>

        <div class="btnrow">
          <button class="btn-green" onclick="__p1bYes()">üü¢ Yes, I agree</button>
          <button class="btn-red" onclick="__p1bNo()">üî¥ No, I don‚Äôt agree</button>
          <button class="btn-yellow" onclick="__p1bYellow()">üü° This question is flawed / incomplete</button>
        </div>


        <img src="1B.png" alt="Part 1 ‚Äî 1B" style="max-width:100%; margin:1.5rem 0 0; border-radius:12px;" />

        ${navButtons({ showBack:true, showNext:false })}
      `;

      // Reliable handlers
      window.__p1bYes = () => {
        state.part1.b = "yes";
        go(STEPS.P1_1C);
      };

      window.__p1bNo = () => {
        state.part1.b = "no";
        go(STEPS.P1_1BX);
      };

      window.__p1bYellow = () => {
        state.part1.b = "yellow";
        openYellowExit();
      };

      window.__next = () => {};
    }



    function renderP1_1BX(){
      setPill("Part 1 ‚Äî 1BX");

      $app.innerHTML = `
        <h1>Part 1 ‚Äî 1BX</h1>

        <p><b>After reviewing the evidence below regarding the sentience of cats and dogs, choose the option that best fits your view.</b></p>

        <img src="1BX.png" alt="Cats and dogs: sentience evidence" style="max-width:100%; margin:1.25rem 0; border-radius:12px;" />

        <h2 style="margin-top:.25rem;">Do cats and dogs actually have these traits?</h2>

        <p>Scientific research strongly supports the idea that cats and dogs are sentient beings with:</p>
        <ul>
          <li>the capacity to feel physical pain</li>
          <li>emotional experiences such as fear, joy, anxiety, and attachment</li>
          <li>social bonds with humans and other animals</li>
          <li>memory, learning, and problem-solving abilities</li>
          <li>a motivation to avoid harm and seek comfort</li>
        </ul>

        <div class="divider"></div>

        <h3>Evidence highlights</h3>

        <details class="drop">
          <summary><b>1) Pain perception</b></summary>
          <p>Cats and dogs have the same basic biological ‚Äúhardware‚Äù for pain as other mammals: nociceptors (pain receptors), spinal pain pathways, and brain processing that supports the experience of pain.</p>
          <ul>
            <li>Veterinary pain guidelines emphasize systematic recognition and treatment of pain in dogs and cats.</li>
            <li>Pain medicines (analgesics) reduce pain-related behavior and distress in clinical settings ‚Äî consistent with pain being more than a simple reflex.</li>
          </ul>
          <p class="small">
            Sources: AAHA Pain Management Guidelines (dogs & cats) ‚Ä¢ WSAVA pain guidelines
          </p>
        </details>

        <details class="drop">
          <summary><b>2) Emotional experience</b></summary>
          <p>Dogs and cats show emotional states that function like what we call fear/anxiety/comfort-seeking/attachment in humans.</p>
          <ul>
            <li>In dogs, behavioral science documents anxiety/fear responses, joy/positive affect, and bonding behaviors.</li>
            <li>In cats, research suggests many cats form attachment bonds to caregivers (secure-base behavior), similar in structure to infant attachment patterns.</li>
          </ul>
          <p class="small">
            Sources: Vitale et al. (Current Biology, 2019) ‚Ä¢ Oregon State University summary
          </p>
        </details>

        <details class="drop">
          <summary><b>3) Social bonding</b></summary>
          <p>Dogs form attachment bonds with humans that show measurable bonding chemistry.</p>
          <ul>
            <li>A well-known study found mutual gaze between dogs and owners is associated with increased oxytocin (a bonding hormone) in both ‚Äî described as a positive feedback ‚Äúbonding loop.‚Äù</li>
            <li>Cat attachment behaviors can include proximity-seeking, separation distress, and comfort-seeking when stressed.</li>
          </ul>
          <p class="small">
            Sources: Nagasawa et al. (Science, 2015) ‚Ä¢ Vitale et al. (Current Biology, 2019)
          </p>
        </details>

        <details class="drop">
          <summary><b>4) Learning, memory, and intention</b></summary>
          <p>Dogs and cats routinely demonstrate learning, memory, and goal-directed behavior:</p>
          <ul>
            <li>learning through reinforcement</li>
            <li>remembering individual humans and routines</li>
            <li>anticipating future events (e.g., cues that predict what happens next)</li>
            <li>modifying behavior to achieve goals</li>
          </ul>
          <p class="small">These capacities strongly support the idea of subjective experience, not mere mechanical reaction.</p>
        </details>

        <details class="drop">
          <summary><b>5) Scientific and scholarly support</b></summary>

          <p>The following sources reflect the current scientific and scholarly understanding of mammalian sentience, emotional experience, and cognitive capacity.</p>

          <ul>
            <li><b>Cambridge Declaration on Consciousness (2012)</b> ‚Äî A group of leading neuroscientists concluded that many non-human animals, including mammals and birds, possess the neurological substrates necessary for conscious experience.</li>

            <li><b>American Animal Hospital Association (AAHA) Pain Management Guidelines</b> ‚Äî Veterinary research recognizes that dogs and cats experience pain through neurological pathways homologous to those in humans, and that analgesics reduce both behavioral and physiological pain responses.</li>

            <li><b>Irvine (2009)</b> ‚Äî Reviews evidence of emotional, social, and cognitive capacities in animals, including attachment, grief, fear, and learning, across both companion and farmed species.</li>

            <li><b>Katsnelson (2022)</b> ‚Äî Summarizes research demonstrating that animals experience emotions such as fear, pleasure, empathy, and distress, and that these states are measurable through behavior and physiology.</li>

            <li><b>ABC News (2005)</b> ‚Äî Reports findings that some farm animals (including pigs and sheep) demonstrate problem-solving abilities and learning capacities comparable to or exceeding those of many dogs.</li>
          </ul>

          <p class="small">
            These findings are consistent across neuroscience, veterinary medicine, and animal behavior research.
          </p>
        </details>

        <div class="divider"></div>

        <h3>What best fits your view?</h3>

        <div class="btnrow">
          <button class="btn-green" onclick="__p1bxAgree()">üü¢ I‚Äôve read the information, and I now agree that cats and dogs are sentient in the way described.</button>
        </div>

        <div class="btnrow" style="margin-top:.75rem;">
          <button class="btn-red" onclick="__p1bxReject()">üî¥ I‚Äôve read the information, but I still reject it. I do not trust science or research in general, because I believe that all or most scientific research is part of a conspiracy to try to convince us of fake "facts".</button>
        </div>

        <div class="btnrow" style="margin-top:.75rem;">
          <button class="btn-yellow" onclick="__p1bxFlawed()">üü° This question / the evidence summary is flawed or incomplete.</button>
        </div>

        ${navButtons({ showBack:true, showNext:false })}
      `;

      window.__p1bxAgree = () => {
        state.part1.bx = "agree";
        go(STEPS.P1_1C);
      };

      window.__p1bxReject = () => {
        state.part1.bx = "reject_science";
        openRedExit("psych"); // ‚ÄúProfessional support recommended‚Äù (psych) per your plan
      };

      window.__p1bxFlawed = () => {
        state.part1.bx = "yellow";
        openYellowExit();
      };

      window.__next = () => {};
    }


    function renderP1_1C(){
      setPill("Part 1 ‚Äî 1C");

      $app.innerHTML = `
        <h1>Part 1 ‚Äî 1C</h1>

        <h2>Do farm animals share these morally relevant traits?</h2>

        <p>Earlier, you agreed that it is morally wrong to cause unnecessary suffering to cats and dogs simply for pleasure because they have:</p>
        <ul>
          <li>the capacity to suffer</li>
          <li>subjective experience</li>
          <li>emotional and social bonds</li>
          <li>intelligence</li>
          <li>and a desire to avoid harm</li>
        </ul>

        <p><b>Research shows that cows and pigs possess these same traits ‚Äî often at comparable or even higher levels.</b></p>

        <img src="1C.png" alt="Part 1 ‚Äî 1C" style="max-width:100%; margin:1.25rem 0; border-radius:12px;" />

        <div class="divider"></div>

        <h3>Evidence highlights (tap to expand)</h3>

        <details class="drop">
          <summary><b>1) Pain perception & avoidance</b></summary>
          <p>Animals do not merely reflexively withdraw from harm ‚Äî they show behavioral, physiological, and cognitive responses consistent with pain experience.</p>

          <p><b>Cows:</b> Reduced feeding, altered posture, and lasting avoidance after painful procedures.</p>
          <p class="small">Weary et al.; Broom; veterinary welfare research</p>

          <p><b>Pigs:</b> Avoid locations associated with pain; show distress vocalizations, trembling, reduced play.</p>
          <p class="small">Marino & Colvin; Applied Animal Behaviour Science</p>

          <p><b>Chickens:</b> Have nociceptors and show prolonged behavior changes after beak trimming.</p>

          <p><b>Fish:</b> Show stress hormones and long-term avoidance learning.</p>

          <p class="small"><b>Supported by:</b> Sneddon et al.; Broom; Weary et al.</p>
        </details>

        <details class="drop">
          <summary><b>2) Emotional experience</b></summary>

          <p><b>Pigs:</b> Experience play, frustration, fear, anxiety, and social pleasure.</p>
          <p class="small">Marino & Colvin; Held & ≈†pinka</p>

          <p><b>Cows:</b> Show distress when separated from bonded partners and pleasure from grooming.</p>
          <p class="small">von Keyserlingk et al.; Proctor & Carder</p>

          <p><b>Chickens:</b> Display fear responses, curiosity, and comfort-seeking.</p>

          <p><b>Sheep:</b> Strong maternal attachment and distress upon separation.</p>
        </details>

        <details class="drop">
          <summary><b>3) Social bonds</b></summary>

          <p><b>Cows:</b> Form long-term friendships and prefer specific companions.</p>
          <p class="small">F√¶revik et al.; Marino & Allen</p>

          <p><b>Pigs:</b> Recognize individuals, form hierarchies, remember social encounters.</p>
          <p class="small">Held et al.; Marino & Colvin</p>

          <p><b>Chickens & Turkeys:</b> Maintain flock hierarchies and social recognition.</p>

          <p><b>Sheep:</b> Use olfactory imprinting to bond with lambs.</p>
        </details>

        <details class="drop">
          <summary><b>4) Intelligence & learning</b></summary>

          <p><b>Pigs:</b> Use mirrors, learn joystick tasks, solve spatial problems.</p>

          <p><b>Cows:</b> Solve conditional tasks and remember complex environments.</p>

          <p><b>Chickens:</b> Show object permanence and numerical discrimination.</p>

          <p class="small"><b>Sources:</b> Marino & Colvin; Nawroth et al.; Marino (2017)</p>
        </details>

        <details class="drop">
          <summary><b>5) Memory & long-term avoidance</b></summary>
          <p>Animals remember aversive events and modify future choices accordingly.</p>

          <ul>
            <li>Cows avoid stressful handling locations.</li>
            <li>Pigs remember pain locations and avoid them.</li>
            <li>Chickens change pecking after discomfort.</li>
            <li>Fish avoid previously aversive zones.</li>
          </ul>
        </details>

        <details class="drop">
          <summary><b>Comparative sentience framework</b></summary>

          <p>Average capacity scores (0‚Äì10):</p>
          <ul>
            <li>Humans ‚Äî 10.00</li>
            <li>Pigs ‚Äî 8.50</li>
            <li>Dogs ‚Äî 8.50</li>
            <li>Cows ‚Äî 8.17</li>
            <li>Cats ‚Äî 8.00</li>
            <li>Sheep/Goats ‚Äî 7.50</li>
            <li>Chickens ‚Äî 7.00</li>
            <li>Turkeys ‚Äî 7.00</li>
            <li>Fish ‚Äî 6.50</li>
          </ul>

          <p class="small">These reflect capability under enriched, nurturing conditions.</p>
        </details>

        <details class="drop">
          <summary><b>Bibliography (APA-style)</b></summary>

          <p class="small">Marino, L., & Colvin, C. M. (2015). Thinking pigs. IJCP.</p>
          <p class="small">Marino, L., & Allen, K. (2017). Psychology of cows. ABC.</p>
          <p class="small">Nawroth et al. (2019). Farm animal cognition. Frontiers.</p>
          <p class="small">Marino, L. (2017). Thinking chickens. Frontiers.</p>
          <p class="small">Sneddon et al. (2014). Animal pain. Animal Behaviour.</p>
          <p class="small">Broom (2014). Sentience and animal welfare.</p>
          <p class="small">Weary et al. (2006). Identifying pain. AABS.</p>
          <p class="small">Proctor & Carder (2014). Emotional states. Animal Welfare.</p>
          <p class="small">F√¶revik et al. (2006). Social preferences. AABS.</p>
        </details>

        <div class="divider"></div>

        <p><b>Therefore:</b> Do you agree that causing unnecessary suffering to animals such as cows and pigs is also morally unacceptable?</p>
        <p class="small">(We will address what counts as ‚Äúnecessary‚Äù in the next section.)</p>

        <div class="btnrow">
          <button class="btn-green" onclick="__p1cYes()">üü¢ Yes ‚Äî cows and pigs also have these traits.</button>
          <button class="btn-red" onclick="__p1cNo()">üî¥ No ‚Äî I do not believe cows and pigs have these traits.</button>
          <button class="btn-yellow" onclick="__p1cYellow()">üü° This comparison is flawed or incomplete.</button>
        </div>
      `;
    }



      function renderP1_1CX_PICK(){
        setPill("Part 1 ‚Äî 1CX (pick)");
        const selected = new Set(state.part1.cxSelected);

        $app.innerHTML = `
          <h1>Part 1 ‚Äî Moral override reasons</h1>

          <p>According to your responses, even though you agree that regularly farmed animals like pigs and cows are sentient and able to suffer at the same level as cats and dogs, you still feel that this is not sufficient to claim that it is morally wrong for you personally to harm or kill them simply for pleasure (or for social, cultural or religious conventions that we will explore further in this section).</p>

          <p>Please look over the rationales below, and choose all that apply to your reasoning. As always, this is a work in progress, so feel free to email me if your reason is not listed.</p>

          <p class="small"><b>Keep in mind:</b> We will explore reasons why eating animals and animal products may be ‚Äúnecessary‚Äù in Part 2. In this section we are only exploring the morality of harm to animals when it is solely for pleasure, social conformity, or religious/spiritual beliefs.</p>

          <div class="divider"></div>

          <img src="1CX.png" alt="Moral override reasons" style="display:block; width:100%; max-width:100%; margin:1.5rem auto; border-radius:12px;" />
          
          <h2>‚ÄúYes they suffer ‚Äî but that doesn‚Äôt matter / isn‚Äôt enough.‚Äù</h2>

          <div class="checklist">
            ${CX_ORDER.map(item => `
              <label class="chk">
                <input type="checkbox" value="${item.id}" ${selected.has(item.id) ? "checked" : ""}/>
                <span><b>${item.label}</b></span>
              </label>
            `).join("")}
          </div>

          <div class="divider"></div>

          <p class="small">If your reason isn‚Äôt listed, you can email feedback here:
            <a href="mailto:Jessica.henry523@gmail.com">Jessica.henry523@gmail.com</a>
          </p>

          ${navButtons({ showBack:true, nextLabel:"Continue to selected" })}
        `;


        window.__next = () => {
          const boxes = Array.from(document.querySelectorAll('input[type="checkbox"]:checked')).map(b => b.value);
          state.part1.cxSelected = boxes;

          // If none selected, just proceed to Part 2 intro
          if (boxes.length === 0){
            go(STEPS.P2_INTRO);
            return;
          }

          // route to the first selected CX step in fixed order
          const first = CX_ORDER.find(x => boxes.includes(x.id));
          go(first.step);
        };
      }

      /***********************
       * PART 1 ‚Äî 1CX1‚Äì1CX5 PAGES
       ***********************/

      // Helper: go to next selected CX in order, else Part 2 intro
      function nextSelectedCX(currentId){
        const selected = new Set(state.part1.cxSelected || []);
        const idx = CX_ORDER.findIndex(x => x.id === currentId);
        for(let i = idx + 1; i < CX_ORDER.length; i++){
          if(selected.has(CX_ORDER[i].id)) return CX_ORDER[i].step;
        }
        return STEPS.P2_INTRO;
      }

      // Reusable ‚ÄúGreen / Red / Yellow‚Äù row (Green, then Red, then Yellow)
      function grYButtons({ greenLabel, redLabel, yellowLabel, onGreen, onRed, onYellow }){
        return `
          <div class="btnrow">
            <button class="btn-green" onclick="${onGreen}()">${greenLabel}</button>
            <button class="btn-red" onclick="${onRed}()">${redLabel}</button>
            <button class="btn-yellow" onclick="${onYellow}()">${yellowLabel}</button>
          </div>
        `;
      }

      /* ========== 1CX1 ‚Äî Purpose-based exemption ========== */
      function renderP1_1CX1(){
        setPill("Part 1 ‚Äî 1CX1");

        $app.innerHTML = `
          <h1>1CX1 ‚Äî Purpose-based exemption</h1>
          <img src="1CX1.jpg" alt="Purpose-based exemption" class="page-img"/>

          <p><b>Claim:</b> ‚ÄúAnimals raised for food are different from pets.‚Äù</p>
          <p>This rationale says moral status depends on <i>human intention</i>: if humans label an animal ‚Äúfood,‚Äù then harming it is morally acceptable even if it can suffer.</p>

          <div class="divider"></div>

          <h2>Part A</h2>
          <p>If a trait (like sentience or the capacity to suffer) is what makes harming dogs/cats wrong, then a label (‚Äúfood‚Äù vs ‚Äúpet‚Äù) doesn‚Äôt change that trait.</p>
          <img src="1CX1A.png" alt="1CX1 Part A" class="page-img"/>

          <h2>Part B</h2>
          <p>This step is asking you whether you believe <b>human categories alone</b> can override morally relevant traits.</p>
          <img src="1CX1B.png" alt="1CX1 Part B" class="page-img"/>

          ${grYButtons({
            greenLabel: "üü¢ I see the inconsistency",
            redLabel: "üî¥ I think the label changes the moral status",
            yellowLabel: "üü° This framing is flawed",
            onGreen: "window.__cx1_green",
            onRed: "window.__cx1_red",
            onYellow: "window.__cx1_yellow"
          })}

          ${navButtons({ showBack:true, showNext:false })}
        `;

        window.__cx1_green = () => { state.part1.cx1 = "green"; go(nextSelectedCX("1CX1")); };
        window.__cx1_red   = () => { state.part1.cx1 = "red";   openRedExit("cultural"); }; // you can change kind later if you want
        window.__cx1_yellow= () => { state.part1.cx1 = "yellow"; openYellowExit(); };
        window.__next = () => {};
      }

      /* ========== 1CX2 ‚Äî Religious exemption (branch) ========== */
      function renderP1_1CX2(){
        setPill("Part 1 ‚Äî 1CX2");

        $app.innerHTML = `
          <h1>1CX2 ‚Äî Religious exemption</h1>
          <img src="1CX2.png" alt="Religious exemption" class="page-img"/>

          <p><b>Claim:</b> ‚ÄúGod permits or commands humans to eat animals.‚Äù</p>
          <p>This rationale says moral authority overrides harm-based reasoning.</p>

          <div class="divider"></div>

          <p><b>Which tradition best matches your reasoning?</b></p>

          <div class="checklist">
            <label class="chk"><input type="radio" name="rel" value="christian" checked/> <span><b>Christian</b></span></label>
            <label class="chk"><input type="radio" name="rel" value="jewish"/> <span><b>Jewish</b></span></label>
            <label class="chk"><input type="radio" name="rel" value="muslim"/> <span><b>Muslim</b></span></label>
            <label class="chk"><input type="radio" name="rel" value="hindu"/> <span><b>Hindu</b></span></label>
            <label class="chk"><input type="radio" name="rel" value="buddhist"/> <span><b>Buddhist</b></span></label>
            <label class="chk"><input type="radio" name="rel" value="sikh"/> <span><b>Sikh</b></span></label>
          </div>

          ${navButtons({ showBack:true, nextLabel:"Continue" })}
        `;

        window.__next = () => {
          const sel = document.querySelector('input[name="rel"]:checked');
          const v = sel ? sel.value : "christian";
          state.part1.cx2Religion = v;
          go(STEPS.P1_1CX2_TRANSITION);
        };
      }

      function renderP1_1CX2Transition(){
        setPill("Part 1 ‚Äî 1CX2");

        $app.innerHTML = `
          <h1>1CX2 ‚Äî Religious exemption</h1>
          <img src="1CX2transition.png" alt="Religious transition" class="page-img"/>

          <p class="small">This page will show a short, respectful summary of how your tradition is commonly interpreted on this issue, and where sincere disagreement exists within the tradition.</p>

          ${navButtons({ showBack:true, nextLabel:"Continue" })}
        `;

        window.__next = () => {
          const r = state.part1.cx2Religion;
          if(r === "buddhist") return go(STEPS.P1_1CX2_BUDDHIST);
          if(r === "christian") return go(STEPS.P1_1CX2_CHRISTIAN);
          if(r === "hindu") return go(STEPS.P1_1CX2_HINDU);
          if(r === "jewish") return go(STEPS.P1_1CX2_JEWISH);
          if(r === "muslim") return go(STEPS.P1_1CX2_MUSLIM);
          if(r === "sikh") return go(STEPS.P1_1CX2_SIKH);
          go(STEPS.P1_1CX2_CHRISTIAN);
        };
      }

      function renderReligiousDetail({ title, img, storageKey }){
        setPill("Part 1 ‚Äî 1CX2");
        $app.innerHTML = `
          <h1>${title}</h1>
          <img src="${img}" alt="${title}" class="page-img"/>

          <p class="small">
            Put your tradition-specific language here (your rough draft text),
            including: what the tradition teaches, how interpretation differs,
            and what ‚Äúminimizing harm‚Äù looks like within that tradition.
          </p>

          ${grYButtons({
            greenLabel: "üü¢ I see how harm-minimization fits my values",
            redLabel: "üî¥ My religious authority overrides this concern",
            yellowLabel: "üü° This is incomplete / needs nuance",
            onGreen: "window.__rel_green",
            onRed: "window.__rel_red",
            onYellow: "window.__rel_yellow"
          })}

          ${navButtons({ showBack:true, showNext:false })}
        `;

        window.__rel_green = () => { state.part1[storageKey] = "green"; go(nextSelectedCX("1CX2")); };
        window.__rel_red   = () => { state.part1[storageKey] = "red";   openRedExit("religious"); };
        window.__rel_yellow= () => { state.part1[storageKey] = "yellow"; openYellowExit(); };
        window.__next = () => {};
      }

      function renderP1_1CX2Buddhist(){ return renderReligiousDetail({ title:"1CX2 ‚Äî Buddhist", img:"1CX2Buddhist.png", storageKey:"cx2_buddhist" }); }
      function renderP1_1CX2Christian(){ return renderReligiousDetail({ title:"1CX2 ‚Äî Christian", img:"1CX2Christian.png", storageKey:"cx2_christian" }); }
      function renderP1_1CX2Hindu(){ return renderReligiousDetail({ title:"1CX2 ‚Äî Hindu", img:"1CX2Hindu.png", storageKey:"cx2_hindu" }); }
      function renderP1_1CX2Jewish(){ return renderReligiousDetail({ title:"1CX2 ‚Äî Jewish", img:"1CX2Jewish.png", storageKey:"cx2_jewish" }); }
      function renderP1_1CX2Muslim(){ return renderReligiousDetail({ title:"1CX2 ‚Äî Muslim", img:"1CX2Muslim.png", storageKey:"cx2_muslim" }); }
      function renderP1_1CX2Sikh(){ return renderReligiousDetail({ title:"1CX2 ‚Äî Sikh", img:"1CX2Sikh.png", storageKey:"cx2_sikh" }); }


      /* ========== 1CX3 ‚Äî Appeal to nature ========== */
      function renderP1_1CX3(){
        setPill("Part 1 ‚Äî 1CX3");
        $app.innerHTML = `
          <h1>1CX3 ‚Äî Appeal to nature</h1>
          <img src="1CX3.png" alt="Appeal to nature" class="page-img"/>

          <p><b>Claim:</b> ‚ÄúPredation is natural, so it‚Äôs morally fine.‚Äù</p>
          <p>This rationale treats ‚Äúnatural‚Äù as automatically morally justified.</p>

          ${grYButtons({
            greenLabel: "üü¢ I see why ‚Äònatural‚Äô ‚â† ‚Äòmorally right‚Äô",
            redLabel: "üî¥ I believe naturalness overrides suffering",
            yellowLabel: "üü° This needs a better framing",
            onGreen: "window.__cx3_green",
            onRed: "window.__cx3_red",
            onYellow: "window.__cx3_yellow"
          })}

          ${navButtons({ showBack:true, showNext:false })}
        `;

        window.__cx3_green = () => { state.part1.cx3 = "green"; go(nextSelectedCX("1CX3")); };
        window.__cx3_red   = () => { state.part1.cx3 = "red";   openRedExit("cultural"); };
        window.__cx3_yellow= () => { state.part1.cx3 = "yellow"; openYellowExit(); };
        window.__next = () => {};
      }

      /* ========== 1CX4 ‚Äî Cultural / identity exemption ========== */
      function renderP1_1CX4(){
        setPill("Part 1 ‚Äî 1CX4");
        $app.innerHTML = `
          <h1>1CX4 ‚Äî Cultural / identity exemption</h1>
          <img src="1CX4.png" alt="Cultural exemption" class="page-img"/>

          <p><b>Claim:</b> ‚ÄúThis is part of my culture / ancestry / identity.‚Äù</p>
          <p>This rationale says tradition can override moral symmetry.</p>

          ${grYButtons({
            greenLabel: "üü¢ I want to reduce harm within my tradition",
            redLabel: "üî¥ Tradition overrides this concern",
            yellowLabel: "üü° This needs nuance",
            onGreen: "window.__cx4_green",
            onRed: "window.__cx4_red",
            onYellow: "window.__cx4_yellow"
          })}

          ${navButtons({ showBack:true, showNext:false })}
        `;

        window.__cx4_green = () => { state.part1.cx4 = "green"; go(nextSelectedCX("1CX4")); };
        window.__cx4_red   = () => { state.part1.cx4 = "red";   openRedExit("cultural"); };
        window.__cx4_yellow= () => { state.part1.cx4 = "yellow"; openYellowExit(); };
        window.__next = () => {};
      }

      /* ========== 1CX5 ‚Äî Human-centered priority ========== */
      function renderP1_1CX5(){
        setPill("Part 1 ‚Äî 1CX5");
        $app.innerHTML = `
          <h1>1CX5 ‚Äî Human-centered priority</h1>
          <img src="1CX5.jpg" alt="Human-centered priority" class="page-img"/>

          <p><b>Claim:</b> ‚ÄúHuman comfort, convenience, or social harmony outweighs animal suffering.‚Äù</p>
          <p>This includes the ‚Äúdon‚Äôt-rock-the-boat / agreeableness‚Äù concern, framed as a moral priority claim.</p>

          ${grYButtons({
            greenLabel: "üü¢ I see why convenience may not justify suffering",
            redLabel: "üî¥ I believe human priorities override",
            yellowLabel: "üü° This needs better options",
            onGreen: "window.__cx5_green",
            onRed: "window.__cx5_red",
            onYellow: "window.__cx5_yellow"
          })}

          ${navButtons({ showBack:true, showNext:false })}
        `;

        window.__cx5_green = () => { state.part1.cx5 = "green"; go(nextSelectedCX("1CX5")); };
        window.__cx5_red   = () => { state.part1.cx5 = "red";   openRedExit("psych"); };
        window.__cx5_yellow= () => { state.part1.cx5 = "yellow"; openYellowExit(); };
        window.__next = () => {};
      }


    function renderP2_Intro(){
      setPill("Part 2 ‚Äî Intro");
      $app.innerHTML = `
        <h1>Part 2 (placeholder intro)</h1>
        <p>This is where you show your ‚ÄúPart 2 disclaimer‚Äù and your ‚Äúthis is only about YOU personally‚Äù reminder.</p>

        ${navButtons({ showBack:true, nextLabel:"Continue to 2A" })}
      `;

      window.__next = () => go(STEPS.P2_2A);
    }

    function renderP2_2A(){
      setPill("Part 2 ‚Äî 2A");
      $app.innerHTML = `
        <h1>Part 2 ‚Äî 2A (placeholder)</h1>
        <p>General: ‚ÄúA well-planned plant-based diet can be nutritionally adequate for the general population.‚Äù</p>
        <p class="small">You can later attach citations and your essay excerpt here.</p>

        ${navButtons({ showBack:true, nextLabel:"Next (Blockers checklist)" })}
      `;

      window.__next = () => go(STEPS.P2_BLOCKERS_PICK);
    }

    function renderP2_BlockersPick(){
      setPill("Part 2 ‚Äî What‚Äôs holding me back?");
      const selected = new Set(state.part2.blockersSelected);

      $app.innerHTML = `
        <h1>What‚Äôs holding you back? (check all that apply)</h1>
        <p>We‚Äôll go through only the boxes you check, one by one, with info and options.</p>

        <div class="checklist">
          ${BLOCKERS.map(b => `
            <label class="chk">
              <input type="checkbox" value="${b.id}" ${selected.has(b.id) ? "checked" : ""}/>
              <span><b>${b.label}</b></span>
            </label>
          `).join("")}
        </div>

        ${navButtons({ showBack:true, nextLabel:"Continue" })}
      `;

      window.__next = () => {
        const boxes = Array.from(document.querySelectorAll('input[type="checkbox"]:checked')).map(b => b.value);
        state.part2.blockersSelected = boxes;

        // build queue in the order of BLOCKERS definition
        state.part2.blockersQueue = BLOCKERS
          .map(b => b.id)
          .filter(id => boxes.includes(id));

        // If none selected, go directly to stakes
        if (state.part2.blockersQueue.length === 0){
          go(STEPS.STAKES);
          return;
        }

        go(STEPS.P2_BLOCKER_DETAIL);
      };
    }

    function renderP2_BlockerDetail(){
      setPill("Part 2 ‚Äî Detail");
      const queue = state.part2.blockersQueue;
      const currentId = queue[0];

      const current = BLOCKERS.find(b => b.id === currentId);

      $app.innerHTML = `
        <h1>Detail: ${current ? current.label : "(unknown)"} </h1>
        <p class="small">Placeholder content. This is where you‚Äôll put your structured info, suggestions, and (later) links/citations.</p>

        <div class="imgbox">
          <b>Content bucket:</b> ${currentId}<br/>
          <span class="small">Swap this for your real copy later.</span>
        </div>

        ${navButtons({ showBack:true, nextLabel: queue.length > 1 ? "Next topic" : "Continue to Stakes" })}
      `;

      window.__next = () => {
        // pop current
        state.part2.blockersQueue.shift();

        // if more, keep walking; else go to stakes
        if (state.part2.blockersQueue.length > 0){
          go(STEPS.P2_BLOCKER_DETAIL);
        } else {
          go(STEPS.STAKES);
        }
      };
    }

    function renderStakes(){
      setPill("Stakes / End screen");

      // Your chosen ‚Äúannual impact‚Äù numbers (placeholder values)
      const impact = {
        chickens: 35,
        turkeys: 1,
        pigs: 1,     // baby pig (visual)
        cows: 1,     // baby cow (visual)
        fish: 27,
        seafood: 250,
        maleChicks: 2,
        bees: 3,
        wildlife: ["mouse", "chipmunk", "sparrow", "lizard", "butterfly"]
      };

      const headline = state.showSavedSpin
        ? "Thank you ‚Äî estimated animals saved per year (placeholder)"
        : "Estimated animals affected per year (placeholder)";

      $app.innerHTML = `
        <h1>${headline}</h1>
        <p class="small">This is where your visual + links will live. This page is intentionally a placeholder box right now.</p>

        <div class="imgbox">
          <b>Visual spec (for later image/art):</b><br/>
          ${impact.chickens} chickens ‚Ä¢ ${impact.turkeys} turkey ‚Ä¢ ${impact.pigs} baby pig ‚Ä¢ ${impact.cows} baby cow<br/>
          ${impact.fish} fish ‚Ä¢ ${impact.seafood} mixed seafood<br/>
          ${impact.maleChicks} male chicks ‚Ä¢ ${impact.bees} bees<br/>
          Wildlife icons: ${impact.wildlife.join(", ")}
        </div>

        <p class="small">Later: embed your ‚Äúnot all-or-nothing‚Äù reminder + your external links (stake education sites).</p>

        ${navButtons({ showBack:true, showNext:false })}
      `;

      window.__next = () => {};
    }

    /***********************
     * DISCLAIMER MODAL
     ***********************/
    const modal = document.getElementById("disclaimerModal");
    const agreeBox = document.getElementById("agreeBox");
    const startBtn = document.getElementById("startBtn");

    let disclaimerAccepted = false;

    startBtn.disabled = true;

    agreeBox.addEventListener("change", () => {
      startBtn.disabled = !agreeBox.checked;
    });

    startBtn.addEventListener("click", () => {
      if (!agreeBox.checked) return;
      disclaimerAccepted = true;
      closeModal();
      if (typeof window.__afterDisclaimer === "function") window.__afterDisclaimer();
    });

    function openModal(){
      modal.style.display = "flex";
    }

    function closeModal(){
      modal.style.display = "none";
    }

    /**
     * openDisclaimerThen(nextFn, {autoOpen})
     * - If already accepted, runs nextFn immediately (if provided).
     * - Otherwise opens modal; stores nextFn to run after accept.
     */
    function openDisclaimerThen(nextFn, opts = {}){
      const { autoOpen=false } = opts;

      if (disclaimerAccepted){
        if (nextFn) nextFn();
        return;
      }

      // store callback
      window.__afterDisclaimer = () => {
        window.__afterDisclaimer = null;
        if (nextFn) nextFn();
      };

      if (autoOpen){
        openModal();
      }
    }

    /***********************
     * INIT
     ***********************/
    // Show START screen
    go(STEPS.START);
  </script>
</body>
</html>
